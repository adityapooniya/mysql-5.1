drop table if exists t;
drop table if exists s;
""
Confirm SHOW options work
""
show global variables like "innodb_drop_table_phase1";
Variable_name	Value
innodb_drop_table_phase1	ON
set global innodb_drop_table_phase1=OFF;
show global variables like "innodb_drop_table_phase1";
Variable_name	Value
innodb_drop_table_phase1	OFF
select variable_name from information_schema.global_status
where variable_name like "Innodb_drop_table_phase%" order by variable_name;
variable_name
INNODB_DROP_TABLE_PHASE1_SECONDS
INNODB_DROP_TABLE_PHASE2_SECONDS
create table t(i int primary key auto_increment) engine=innodb;
insert into t values (null), (null), (null), (null);
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
insert into t select null from t;
create table s engine=innodb as select * from t;
""
Confirm timers don't go backwards with option off
""
select variable_name into @a_p1secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase1_seconds";
select variable_name into @a_p2secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase2_seconds";
drop table t;
select variable_name into @b_p1secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase1_seconds";
select variable_name into @b_p2secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase2_seconds";
select (@b_p1secs - @a_p1secs) >= 0;
(@b_p1secs - @a_p1secs) >= 0
1
select (@b_p2secs - @a_p2secs) >= 0;
(@b_p2secs - @a_p2secs) >= 0
1
set global innodb_drop_table_phase1=ON;
show global variables like "innodb_drop_table_phase1";
Variable_name	Value
innodb_drop_table_phase1	ON
""
Confirm timers don't go backwards with option on
""
select variable_name into @a_p1secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase1_seconds";
select variable_name into @a_p2secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase2_seconds";
drop table s;
select variable_name into @b_p1secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase1_seconds";
select variable_name into @b_p2secs from information_schema.global_status
where variable_name = "Innodb_drop_table_phase2_seconds";
select (@b_p1secs - @a_p1secs) >= 0;
(@b_p1secs - @a_p1secs) >= 0
1
select (@b_p2secs - @a_p2secs) >= 0;
(@b_p2secs - @a_p2secs) >= 0
1
