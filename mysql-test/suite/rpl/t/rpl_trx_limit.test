source include/have_innodb_plugin.inc;
source include/master-slave.inc;

connection slave;
show global variables like "relay_log_space_limit";
show global variables like "relay_log_space_purge";

connection master;
--disable_warnings
drop table if exists t1;
--enable_warnings

CREATE TABLE t1(a int primary key auto_increment, b char(250)) engine=innodb;

--disable_query_log
let $x=10;
while ($x) {
  insert into t1 values(NULL,'foobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobar');
  dec $x;
}
--enable_query_log

sync_slave_with_master;
connection master;

--disable_query_log
let $x=5000;
while ($x) {
  insert into t1 values(NULL,'foobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobar');
  dec $x;
}
--enable_query_log

connection slave;
let $s = query_get_value(SHOW SLAVE STATUS, Relay_Log_Space, 1);
--echo Relay_Log_Space $s

connection master;
--disable_query_log
let $x=5000;
while ($x) {
  insert into t1 values(NULL,'foobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobar');
  dec $x;
}
--enable_query_log

connection slave;
let $s = query_get_value(SHOW SLAVE STATUS, Relay_Log_Space, 1);
--echo Relay_Log_Space $s

connection master;
--disable_query_log
let $x=5000;
while ($x) {
  insert into t1 values(NULL,'foobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobar');
  dec $x;
}
--enable_query_log

connection slave;
let $s = query_get_value(SHOW SLAVE STATUS, Relay_Log_Space, 1);
--echo Relay_Log_Space $s

# connection master;
# DROP TABLE t1;
# sync_slave_with_master;
# --query_vertical show slave status
